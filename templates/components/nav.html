{% load static %}
<!-- Sidebar -->
<aside class="flex h-full w-20 flex-col items-center justify-between border-r border-base-200 bg-base-100 py-5">
  <!-- Top Section -->
  <div class="flex flex-col items-center gap-y-5">
    <!-- Logo -->
    <div class="sidebar-link flex h-12 w-12 items-center justify-center rounded-full bg-logo text-gray-500 shadow-lg transition-all duration-200 ring-2 ring-gray-100 hover:scale-105"> 
      <img src="{% static 'vibereach-logo.png' %}" alt="Logo">
    </div>

    <!-- Navigation Icons -->
    <nav>
      <ul class="flex flex-col items-center gap-y-2">
        <!-- Products -->
        <li>
          <div class="tooltip tooltip-right" data-tip="Products">
            <a href="{% url 'products' %}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
              <i class="fa-solid fa-box text-l"></i>
            </a>
          </div>
        </li>

        <!-- Email Accounts -->
        <!-- <li>
          <div class="tooltip tooltip-right" data-tip="Email Accounts">
            <a href="{# url 'email_accounts' #}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
              <i class="fa-solid fa-at text-l"></i>
            </a>
          </div>
        </li> -->

        <!-- Leads -->
        <li id="leads-tab">
          <div class="tooltip tooltip-right" data-tip="Leads">
            <a href="{% url 'leads_lists' %}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
              <i class="fa-solid fa-users text-l"></i>
            </a>
          </div>
        </li>

        <!-- Messages -->
        <li id="msgs-tab">
          <div class="tooltip tooltip-right" data-tip="Messages">
            <a href="{% url 'messages' %}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
              <i class="fa-solid fa-envelope text-l"></i>
            </a>
          </div>
        </li>

        <!-- Campaigns -->
        <li id="campaigns-tab" class="mt-2 mb-2">
          <div class="tooltip tooltip-right" data-tip="Campaigns">
            <a href="{% url 'campaign_view_list' %}" 
              class="sidebar-link flex h-12 w-12 items-center justify-center rounded-full bg-base-200 text-gray-500 shadow-lg transition-all duration-200 ring-2 ring-gray-200 hover:scale-105"> 
              <i class="fa-solid fa-paper-plane text-xl"></i>
            </a>
          </div>
        </li>

        <!-- Links -->
        <li id="links-tab">
          <div class="tooltip tooltip-right" data-tip="Links">
            <a href="{% url 'links' %}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
              <i class="fa-solid fa-link text-l"></i>
            </a>
          </div>
        </li>

        <!-- Overall Dashboard -->
        <li id="overall-dashboard-tab">
          <div class="tooltip tooltip-right" data-tip="Overall Dashboard">
            <a href="{% url 'overall_dashboard' %}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
              <i class="fa-solid fa-chart-line text-l"></i>
            </a>
          </div>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Bottom Section -->
  <div class="flex flex-col items-center gap-y-3">
    <!-- Feedback -->
    <div id="feedback-tab" class="tooltip tooltip-right" data-tip="Submit Feedback">
      <a href="{% url 'feedback' %}" class="sidebar-link flex h-12 w-12 items-center justify-center rounded-lg text-gray-500 hover:bg-base-200 hover:text-blue-600 transition-all duration-200">
        <i class="fa-solid fa-comment-dots text-l"></i>
      </a>
    </div>

    <!-- User Account -->
    <div id="account-settings-tab" class="tooltip tooltip-right" data-tip="Account Settings">
      <a id="account-settings-link" href="{% url 'account_settings' %}" class="sidebar-link avatar placeholder active">
        <div class="w-8 rounded-full bg-neutral text-neutral-content hover:bg-primary transition-all duration-200 cursor-pointer">
          <span class="text-sm">{% if not request.user.first_name %}U{% else %}{{ request.user.first_name|slice:":1" }}{% endif %}</span>
        </div>
      </a>
    </div>
  </div>
</aside>

<style>
/* Enhanced navigation styles */
.sidebar-link {
  position: relative;
}

.sidebar-link:hover {
  transform: scale(1.05);
}

.sidebar-link {
  border-radius: 9999px; /* A full circle */
  background-color: transparent;
  color: oklch(var(--bc) / 0.5); /* Muted base-content color for the icon */
  transition-property: color, background-color;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 200ms;
  cursor: pointer;
}

.sidebar-link:hover {
  background-color: oklch(var(--b2)); /* base-200 on hover */
  color: oklch(var(--bc) / 1); /* Full base-content color on hover */
}

/* --- ACTIVE STATE --- */
/* This is the class you'll dynamically add with Django */
.sidebar-link.active {
  background-color: oklch(var(--b2)); /* Primary color with 20% opacity */
  color: oklch(var(--p)); /* Full primary color for the icon */
  border-radius: 0.5rem; /* Change from circle to rounded square for emphasis */
}

.tooltip {
  z-index: 1000;
}

.bg-logo{
  background-color: #f7f5f1;
}
</style>

<script>
  {% if not request.user.first_name %}
  const currentPath = window.location.pathname;
  if (currentPath !== "{% url 'account_settings' %}") {
    window.location.href = "{% url 'account_settings' %}";
  }
  // Redirect all sidebar links to /account-settings/ if user hasn't completed profile
  document.addEventListener("DOMContentLoaded", function () {
    // Change all sidebar links to point to account settings
    document.querySelectorAll(".sidebar-link").forEach(link => {
      // Skip the account settings link itself
      if (link.id !== "account-settings-link") {
        link.setAttribute("href", "{% url 'account_settings' %}");
      }
    });   
  });

  {% else %}
  document.addEventListener("DOMContentLoaded", function () {
    const currentPath = window.location.pathname;
    document.querySelectorAll(".sidebar-link").forEach(link => {
      // Check if the link's href is part of the current URL
      if (link.getAttribute("href") === currentPath) {
        link.classList.add("active");
        link.classList.remove("text-gray-500");
      } else {
        link.classList.remove("active");
      }
    });
  });
  {% endif %}
</script>